(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[22],{1370:function(e,t,n){"use strict";n.r(t);n(569);var a=n(568),r=(n(591),n(593)),c=(n(592),n(594)),u=(n(200),n(112)),s=(n(111),n(37)),i=n(1353),o=n(35),p=n.n(o),f=n(58),l=(n(86),n(34)),h=(n(663),n(719)),d=n(0),m=n.n(d),v=n(47),b=n.n(v),x=function(e,t){return new Promise((function(n){var a=new Worker("/hash.js");a.postMessage({fileChunkList:e}),a.onmessage=function(e){var a=e.data,r=a.percentage,c=a.hash;t(r),c&&n(c)}}))},g=function(e,t){for(var n=[],a=0;a<e.size;)n.push({file:e.slice(a,a+t)}),a+=t;return n},j=10485760,O=[],k=[{title:"\u6587\u4ef6\u540d",dataIndex:"filename"},{title:"\u6587\u4ef6\u5207\u7247\u540d",dataIndex:"hash",key:"hash"},{title:"\u5207\u7247\u5927\u5c0f\uff08MB\uff09",dataIndex:"chunk",render:function(e){return Math.floor(e.size/1024)}},{title:"\u4e0a\u4f20\u8fdb\u5ea6",dataIndex:"percentage",render:function(e){return m.a.createElement(h.a,{percent:e})}},{title:"\u64cd\u4f5c",render:function(e){return m.a.createElement(l.a,{type:"link"},"\u64cd\u4f5c")}}],y=function(e){var t=e.url,n=e.method,a=void 0===n?"post":n,r=e.data,c=e.headers,u=void 0===c?{}:c,s=e.onProgress,i=void 0===s?function(e){return e}:s;e.requestList;return new Promise((function(e){var n=new XMLHttpRequest;n.upload.onprogress=i,n.open(a,t),u.Authorization=b.a.get("token"),Object.keys(u).forEach((function(e){return n.setRequestHeader(e,u[e])})),n.send(r),n.onload=function(t){e({data:t.target.response})}}))},w=function(e,t,n){return function(a){e.percentage=parseInt(String(a.loaded/a.total*100));var r=n.map((function(t){return t.hash===e.hash&&(t.percentage=e.percentage),t}));t(r)}},E=function(e,t,n){return e.map((function(e){var n=e.chunk,a=e.hash,r=e.index,c=e.fileHash,u=new FormData;return u.append("chunk",n),u.append("hash",a),u.append("filename",t.name),u.append("fileHash",c),{formData:u,index:r}})).map(function(){var t=Object(f.a)(p.a.mark((function t(a){var r,c,u;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.formData,c=a.index,t.next=3,y({url:"/api//bigupload",data:r,onProgress:w(e[c],n,e)});case 3:u=t.sent,O.push(u);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},S=function(){var e=Object(f.a)(p.a.mark((function e(t,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y({url:"/api/mergefile",headers:{"content-type":"application/json"},data:JSON.stringify({filename:t.name,fileHash:n,size:j})});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),H=function(){var e=Object(f.a)(p.a.mark((function e(t,n){var a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y({url:"/api/verify",headers:{"content-type":"application/json"},data:JSON.stringify({filename:t,fileHash:n})});case 2:return a=e.sent,r=a.data,e.abrupt("return",JSON.parse(r));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t.default=function(){var e=Object(d.useState)([]),t=Object(i.a)(e,2),n=t[0],o=t[1],v=Object(d.useState)({}),b=Object(i.a)(v,2),O=b[0],y=b[1],w=Object(d.useState)([]),z=Object(i.a)(w,2),I=z[0],J=z[1],P=Object(d.useState)(!1),M=Object(i.a)(P,2),q=M[0],C=M[1],D=Object(d.useState)(0),L=Object(i.a)(D,2),N=L[0],R=L[1];Object(d.useEffect)((function(){}),[n]);var A=function(){var e=Object(f.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O.name){e.next=2;break}return e.abrupt("return");case 2:return C(!0),t=g(O,j),e.next=6,x(t,R);case 6:return n=e.sent,a=t.map((function(e,t){return{filename:O.name,fileHash:n,chunk:e.file,hash:n+"-"+t,index:t,percentage:0}})),e.next=10,H(O.name,n);case 10:if(r=e.sent,r.shouldUpload){e.next=16;break}return s.a.error("\u6587\u4ef6\u5df2\u5b58\u5728"),C(!1),e.abrupt("return");case 16:return J(a),e.next=19,Promise.all(E(a,O,o));case 19:return C(!1),e.next=22,S(O,n);case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return m.a.createElement("div",null,m.a.createElement(r.a,null,m.a.createElement(c.a,{span:16},m.a.createElement(u.a,{type:"file",onChange:function(e){var t=Object(i.a)(e.target.files,1)[0];y(t)}})),m.a.createElement(c.a,{span:6,push:1},m.a.createElement(l.a,{type:"primary",onClick:A,loading:q},"\u70b9\u51fb\u4e0a\u4f20"))),m.a.createElement(r.a,{style:{margin:"10px"}},m.a.createElement(c.a,{span:6,style:{fontSize:"14px"}},"\u8ba1\u7b97 hash \u8fdb\u5ea6 \uff1a"),m.a.createElement(c.a,{span:18},m.a.createElement(h.a,{percent:N}))),m.a.createElement(r.a,null,m.a.createElement(a.a,{bordered:!0,columns:k,size:"small",dataSource:I,rowKey:function(e){return e.hash}})))}}}]);